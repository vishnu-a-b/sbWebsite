{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///Users/vishnuab/Official/SbWebsite/client/app/api/upload/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { writeFile, mkdir } from 'fs/promises';\nimport path from 'path';\nimport { existsSync } from 'fs';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const formData = await request.formData();\n    const file = formData.get('file') as File;\n    const type = formData.get('type') as string || 'any';\n\n    if (!file) {\n      return NextResponse.json(\n        { success: false, error: 'No file uploaded' },\n        { status: 400 }\n      );\n    }\n\n    // Validate file\n    const maxSize = 50 * 1024 * 1024; // 50MB\n    if (file.size > maxSize) {\n      return NextResponse.json(\n        { success: false, error: 'File size must be less than 50MB' },\n        { status: 400 }\n      );\n    }\n\n    // Get file extension\n    const bytes = await file.arrayBuffer();\n    const buffer = Buffer.from(bytes);\n    const ext = file.name.split('.').pop();\n\n    // Generate unique filename\n    const timestamp = Date.now();\n    const randomString = Math.random().toString(36).substring(7);\n    const filename = `${timestamp}-${randomString}.${ext}`;\n\n    // Determine upload directory based on type\n    let subDir = 'uploads';\n    if (type === 'video' || file.type.startsWith('video/')) {\n      subDir = 'video';\n    } else if (type === 'image' || file.type.startsWith('image/')) {\n      subDir = 'images';\n    }\n\n    // Backend public directory path (assuming client and backend are siblings)\n    const backendPublicDir = path.join(process.cwd(), '../backend/public');\n    const fullUploadDir = path.join(backendPublicDir, subDir);\n\n    // Create directory if it doesn't exist\n    if (!existsSync(fullUploadDir)) {\n      await mkdir(fullUploadDir, { recursive: true });\n    }\n\n    // Write file\n    const filepath = path.join(fullUploadDir, filename);\n    await writeFile(filepath, buffer);\n\n    // Return URL (pointing to backend static serve)\n    // Use API_BASE_URL and remove /api to get the root backend URL\n    const { default: API_BASE_URL } = await import('@/lib/api');\n    const backendUrl = API_BASE_URL.replace(/\\/api$/, '');\n    const url = `${backendUrl}/public/${subDir}/${filename}`;\n\n    return NextResponse.json({\n      success: true,\n      url,\n      filename,\n      size: file.size,\n      type: file.type\n    });\n  } catch (error) {\n    console.error('Upload error:', error);\n    return NextResponse.json(\n      { success: false, error: 'Failed to upload file' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,WAAW,MAAM,QAAQ,QAAQ;QACvC,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,MAAM,OAAO,SAAS,GAAG,CAAC,WAAqB;QAE/C,IAAI,CAAC,MAAM;YACT,OAAO,mLAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAmB,GAC5C;gBAAE,QAAQ;YAAI;QAElB;QAEA,gBAAgB;QAChB,MAAM,UAAU,KAAK,OAAO,MAAM,OAAO;QACzC,IAAI,KAAK,IAAI,GAAG,SAAS;YACvB,OAAO,mLAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAmC,GAC5D;gBAAE,QAAQ;YAAI;QAElB;QAEA,qBAAqB;QACrB,MAAM,QAAQ,MAAM,KAAK,WAAW;QACpC,MAAM,SAAS,OAAO,IAAI,CAAC;QAC3B,MAAM,MAAM,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG;QAEpC,2BAA2B;QAC3B,MAAM,YAAY,KAAK,GAAG;QAC1B,MAAM,eAAe,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC;QAC1D,MAAM,WAAW,GAAG,UAAU,CAAC,EAAE,aAAa,CAAC,EAAE,KAAK;QAEtD,2CAA2C;QAC3C,IAAI,SAAS;QACb,IAAI,SAAS,WAAW,KAAK,IAAI,CAAC,UAAU,CAAC,WAAW;YACtD,SAAS;QACX,OAAO,IAAI,SAAS,WAAW,KAAK,IAAI,CAAC,UAAU,CAAC,WAAW;YAC7D,SAAS;QACX;QAEA,2EAA2E;QAC3E,MAAM,mBAAmB,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;QAClD,MAAM,gBAAgB,4GAAI,CAAC,IAAI,CAAC,kBAAkB;QAElD,uCAAuC;QACvC,IAAI,CAAC,IAAA,2GAAU,EAAC,gBAAgB;YAC9B,MAAM,IAAA,8HAAK,EAAC,eAAe;gBAAE,WAAW;YAAK;QAC/C;QAEA,aAAa;QACb,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,eAAe;QAC1C,MAAM,IAAA,kIAAS,EAAC,UAAU;QAE1B,gDAAgD;QAChD,+DAA+D;QAC/D,MAAM,EAAE,SAAS,YAAY,EAAE,GAAG;QAClC,MAAM,aAAa,aAAa,OAAO,CAAC,UAAU;QAClD,MAAM,MAAM,GAAG,WAAW,QAAQ,EAAE,OAAO,CAAC,EAAE,UAAU;QAExD,OAAO,mLAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;YACA;YACA,MAAM,KAAK,IAAI;YACf,MAAM,KAAK,IAAI;QACjB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,mLAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAwB,GACjD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}